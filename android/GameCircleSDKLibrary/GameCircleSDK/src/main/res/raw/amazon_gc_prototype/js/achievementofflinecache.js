/*! Copyright 2013 Amazon Digital Services, Inc. All rights reserved. */
AchievementOfflineCache=(function(){var a=function(){this["getCachedAchievement"]=function(f,g){console.log("AchievementOfflineCache: getCachedAchievement");var b=$.Deferred();if(f===constants.NativeCallKeys.SELF_PLAYER_ID){var e={};e[constants.NativeCallKeys.PRIMARY_KEY]=g+f;var h=NativeTransport.callNative({nativeCall:constants.NativeCallTypes.GET_CACHE_ITEM,target:constants.OfflineCacheTypes.ACHIEVEMENTS_CACHE,args:e});h.always(function(j,i){console.log("AchievementOfflineCache: getCachedAchievement complete: "+JSON.stringify(j));var k={achievement:j};b.resolve(k,i)})}else{console.log("AchievementOfflineCache: getCachedAchievement only enabled for current user");var d=constants.NativeCallResultCode.ERROR;var c={};b.resolve(c,d)}return b.promise()};this["cacheAchievement"]=function(b,c,f){console.log("AchievementOfflineCache: cacheAchievement");var i=$.Deferred();if(b===constants.NativeCallKeys.SELF_PLAYER_ID){var d={};var g={};g[constants.NativeCallKeys.PRIMARY_KEY]=c+b;g[constants.NativeCallKeys.SECONDARY_KEY]=b;g[constants.NativeCallKeys.JSON_DATA]=f.achievement;d[constants.NativeCallKeys.CACHE_REQUEST]=g;var j=NativeTransport.callNative({nativeCall:constants.NativeCallTypes.SET_CACHE_ITEM,target:constants.OfflineCacheTypes.ACHIEVEMENTS_CACHE,args:d});j.always(function(l,k){console.log("AchievementOfflineCache: cacheAchievement complete");i.resolve(l,k)})}else{console.log("AchievementOfflineCache: cacheAchievement only enabled for current user");var h=constants.NativeCallResultCode.SUCCESS;var e={};i.resolve(e,h)}return i.promise()};this["getCachedAchievements"]=function(f){console.log("AchievementOfflineCache: getCachedAchievements");var b=$.Deferred();if(f===constants.NativeCallKeys.SELF_PLAYER_ID){var e={};e[constants.NativeCallKeys.SECONDARY_KEY]=f;var g=NativeTransport.callNative({nativeCall:constants.NativeCallTypes.QUERY_CACHE_ITEMS,target:constants.OfflineCacheTypes.ACHIEVEMENTS_CACHE,args:e});g.always(function(i,h){console.log("AchievementOfflineCache: getCachedAchievements complete: "+JSON.stringify(i));var j={achievements:{achievements:i.queryResult}};b.resolve(j,h)})}else{console.log("AchievementOfflineCache: getCachedAchievements only enabled for current user");var d=constants.NativeCallResultCode.ERROR;var c={};b.resolve(c,d)}return b.promise()};this["cacheAchievements"]=function(b,e){console.log("AchievementOfflineCache: cacheAchievements");var h=$.Deferred();if(b===constants.NativeCallKeys.SELF_PLAYER_ID){var c={};var j=[];var f=e.achievements["achievements"];$.each(f,function(m,k){var n=k.achievementMeta["id"];var l={};l[constants.NativeCallKeys.PRIMARY_KEY]=n+b,l[constants.NativeCallKeys.SECONDARY_KEY]=b,l[constants.NativeCallKeys.JSON_DATA]=k,j.push(l)});c[constants.NativeCallKeys.CACHE_REQUESTS]=j;var i=NativeTransport.callNative({nativeCall:constants.NativeCallTypes.SET_CACHE_ITEMS,target:constants.OfflineCacheTypes.ACHIEVEMENTS_CACHE,args:c});i.always(function(l,k){console.log("AchievementOfflineCache: cacheAchievements complete");h.resolve(l,k)})}else{console.log("AchievementOfflineCache: cacheAchievements only enabled for current user");var g=constants.NativeCallResultCode.SUCCESS;var d={};h.resolve(d,g)}return h.promise()};this["updateCachedAchievementProgress"]=function(g,h,f){var c=$.Deferred();if(g===constants.NativeCallKeys.SELF_PLAYER_ID){console.log("AchievementOfflineCache: updateAchievementProgress");var b=this;this.getCachedAchievement(g,h).always(function(i,l){if(l==constants.NativeCallResultCode.SUCCESS){if(i&&i.achievement&&i.achievement["achievementMeta"]){var k=false;if(f===100){k=true}var m={progress:f,unlocked:k};if(k){m.dateUnlocked=new Date().getTime()}i.achievement["playerInfo"]=m;b.cacheAchievement(constants.NativeCallKeys.SELF_PLAYER_ID,h,i).always(function(o,n){c.resolve(o,n)})}else{var j={};c.resolve(j,constants.NativeCallResultCode.ERROR)}}else{var j={};c.resolve(j,constants.NativeCallResultCode.ERROR)}})}else{console.log("AchievementOfflineCache: updateCachedAchievementProgress only enabled for current user");var e=constants.NativeCallResultCode.ERROR;var d={};c.resolve(d,e)}return c.promise()};this["clear"]=function(){console.log("AchievementOfflineCache: clear");var b=$.Deferred();var c={};var d=NativeTransport.callNative({nativeCall:constants.NativeCallTypes.CLEAR_CACHE,target:constants.OfflineCacheTypes.ACHIEVEMENTS_CACHE,args:c});d.done(function(f,e){console.log("AchievementOfflineCache: clear complete: "+JSON.stringify(f));b.resolve(f,e)});return b.promise()};this["loadIcon"]=function(d,b,c){console.log("AchievementOfflineCache: loadIcon")}};return a}());console.log("AchievementOfflineCache loaded.");