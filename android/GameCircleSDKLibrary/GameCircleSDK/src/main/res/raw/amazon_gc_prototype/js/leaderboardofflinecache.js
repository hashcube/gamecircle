/*! Copyright 2013 Amazon Digital Services, Inc. All rights reserved. */
LeaderboardOfflineCache=(function(){var a=function(){this["getScores"]=function(d,j,b,c,e,f,g){console.log("LeaderboardOfflineCache: getScores");var i=$.Deferred();var h={};h[constants.NativeCallKeys.PRIMARY_KEY]="scores-"+d+"-"+b+"-"+c+"-"+e+"-"+g;var k=NativeTransport.callNative({nativeCall:constants.NativeCallTypes.GET_CACHE_ITEM,target:constants.OfflineCacheTypes.LEADERBOARDS_CACHE,args:h});k.done(function(m,l){console.log("LeaderboardOfflineCache: getScores complete: "+JSON.stringify(m));var n=m;i.resolve(n,l)});return i.promise()};this["cacheScoresForGame"]=function(d,m,b,c,e,f,g,i){console.log("LeaderboardOfflineCache: cacheScoresForGame");var l=$.Deferred();var h={};var j={};var k="scores-"+d+"-"+b+"-"+c+"-"+e+"-"+g;j[constants.NativeCallKeys.PRIMARY_KEY]=k;j[constants.NativeCallKeys.SECONDARY_KEY]=k;j[constants.NativeCallKeys.JSON_DATA]=i;h[constants.NativeCallKeys.CACHE_REQUEST]=j;var n=NativeTransport.callNative({nativeCall:constants.NativeCallTypes.SET_CACHE_ITEM,target:constants.OfflineCacheTypes.LEADERBOARDS_CACHE,args:h});n.done(function(p,o){console.log("LeaderboardOfflineCache: cacheScoresForGame complete");l.resolve(p,o)});return l.promise()};this["getPercentiles"]=function(d,i,b,c){console.log("LeaderboardOfflineCache: getPercentiles");var h=$.Deferred();if(d===constants.NativeCallKeys.SELF_PLAYER_ID){var e={};e[constants.NativeCallKeys.PRIMARY_KEY]="percentiles-"+d+"-"+b+"-"+c;var j=NativeTransport.callNative({nativeCall:constants.NativeCallTypes.GET_CACHE_ITEM,target:constants.OfflineCacheTypes.LEADERBOARDS_CACHE,args:e});j.done(function(l,k){console.log("LeaderboardOfflineCache: getPercentiles complete: "+JSON.stringify(l));var m=l;h.resolve(m,k)})}else{console.log("LeaderboardOfflineCache: getPercentiles only enabled for current user");var g=constants.NativeCallResultCode.ERROR;var f={};h.resolve(f,g)}return h.promise()};this["cachePercentiles"]=function(d,k,b,c,g){console.log("LeaderboardOfflineCache: cachePercentiles");var j=$.Deferred();if(d===constants.NativeCallKeys.SELF_PLAYER_ID){var e={};var i={};i[constants.NativeCallKeys.PRIMARY_KEY]="percentiles-"+d+"-"+b+"-"+c;i[constants.NativeCallKeys.SECONDARY_KEY]="percentiles-"+d+"-"+b;i[constants.NativeCallKeys.JSON_DATA]=g;e[constants.NativeCallKeys.CACHE_REQUEST]=i;var l=NativeTransport.callNative({nativeCall:constants.NativeCallTypes.SET_CACHE_ITEM,target:constants.OfflineCacheTypes.LEADERBOARDS_CACHE,args:e});l.done(function(n,m){console.log("LeaderboardOfflineCache: cachePercentiles complete");j.resolve(n,m)})}else{console.log("LeaderboardOfflineCache: cachePercentiles only enabled for current user");var h=constants.NativeCallResultCode.SUCCESS;var f={};j.resolve(f,h)}return j.promise()};this["getLocalPlayerScore"]=function(d,i,b,c){console.log("LeaderboardOfflineCache: getLocalPlayerScore");var h=$.Deferred();if(d===constants.NativeCallKeys.SELF_PLAYER_ID){var e={};e[constants.NativeCallKeys.PRIMARY_KEY]="localScore-"+b+"-"+c+"-"+d;var j=NativeTransport.callNative({nativeCall:constants.NativeCallTypes.GET_CACHE_ITEM,target:constants.OfflineCacheTypes.LEADERBOARDS_CACHE,args:e});j.done(function(l,k){console.log("LeaderboardOfflineCache: getLocalPlayerScore complete: "+JSON.stringify(l));var m=l;h.resolve(m,k)})}else{console.log("LeaderboardOfflineCache: getLocalPlayerScore only enabled for current user");var g=constants.NativeCallResultCode.ERROR;var f={};h.resolve(f,g)}return h.promise()};this["cacheLocalPlayerScore"]=function(d,k,b,c,g){console.log("LeaderboardOfflineCache: cacheLocalPlayerScore");var j=$.Deferred();if(d===constants.NativeCallKeys.SELF_PLAYER_ID){var e={};var i={};i[constants.NativeCallKeys.PRIMARY_KEY]="localScore-"+b+"-"+c+"-"+d;i[constants.NativeCallKeys.SECONDARY_KEY]="localScore-"+b+"-"+c+"-"+d;i[constants.NativeCallKeys.JSON_DATA]=g;e[constants.NativeCallKeys.CACHE_REQUEST]=i;var l=NativeTransport.callNative({nativeCall:constants.NativeCallTypes.SET_CACHE_ITEM,target:constants.OfflineCacheTypes.LEADERBOARDS_CACHE,args:e});l.done(function(n,m){console.log("LeaderboardOfflineCache: cacheLocalPlayerScore complete");j.resolve(n,m)})}else{console.log("LeaderboardOfflineCache: cacheLocalPlayerScore only enabled for current user");var h=constants.NativeCallResultCode.SUCCESS;var f={};j.resolve(f,h)}return j.promise()};this["getLeaderboards"]=function(d,e){console.log("LeaderboardOfflineCache: getLeaderboards");var b=$.Deferred();var c={};c[constants.NativeCallKeys.SECONDARY_KEY]="leaderModel-"+d;var f=NativeTransport.callNative({nativeCall:constants.NativeCallTypes.QUERY_CACHE_ITEMS,target:constants.OfflineCacheTypes.LEADERBOARDS_CACHE,args:c});f.done(function(h,g){console.log("LeaderboardOfflineCache: getLeaderboards complete: "+JSON.stringify(h));var i={LeaderboardList:h.queryResult};b.resolve(i,g)});return b.promise()};this["cacheLeaderboards"]=function(e,g,h){console.log("LeaderboardOfflineCache: cacheLeaderboards");var b=$.Deferred();var d={};var c=[];var f=h.LeaderboardList;$.each(f,function(m,j){var l=j.LeaderboardInfo["LeaderboardId"];var k={};k[constants.NativeCallKeys.PRIMARY_KEY]="leaderModel-"+l+"-"+e;k[constants.NativeCallKeys.SECONDARY_KEY]="leaderModel-"+e;k[constants.NativeCallKeys.JSON_DATA]=j;c.push(k)});d[constants.NativeCallKeys.CACHE_REQUESTS]=c;var i=NativeTransport.callNative({nativeCall:constants.NativeCallTypes.SET_CACHE_ITEMS,target:constants.OfflineCacheTypes.LEADERBOARDS_CACHE,args:d});i.done(function(k,j){console.log("LeaderboardOfflineCache: cacheLeaderboards complete");b.resolve(k,j)});return b.promise()};this["getLeaderboardInfo"]=function(e,d){console.log("LeaderboardOfflineCache: getLeaderboardInfo");var b=$.Deferred();var c={};c[constants.NativeCallKeys.PRIMARY_KEY]="leaderMeta-"+d;var f=NativeTransport.callNative({nativeCall:constants.NativeCallTypes.GET_CACHE_ITEM,target:constants.OfflineCacheTypes.LEADERBOARDS_CACHE,args:c});f.done(function(h,g){console.log("LeaderboardOfflineCache: getLeaderboardInfo complete: "+JSON.stringify(h));var i={LeaderboardInfo:h};b.resolve(i,g)});return b.promise()};this["cacheLeaderboardInfoItems"]=function(f,c){console.log("LeaderboardOfflineCache: cacheLeaderboards");var b=$.Deferred();var e={};var d=[];$.each(c,function(l,h){var k=h.LeaderboardId;var j={};j[constants.NativeCallKeys.PRIMARY_KEY]="leaderMeta-"+k;j[constants.NativeCallKeys.SECONDARY_KEY]="leaderMeta-"+k;j[constants.NativeCallKeys.JSON_DATA]=h;d.push(j)});e[constants.NativeCallKeys.CACHE_REQUESTS]=d;var g=NativeTransport.callNative({nativeCall:constants.NativeCallTypes.SET_CACHE_ITEMS,target:constants.OfflineCacheTypes.LEADERBOARDS_CACHE,args:e});g.done(function(i,h){console.log("LeaderboardOfflineCache: cacheLeaderboardInfoItems complete");b.resolve(i,h)});return b.promise()};this["clear"]=function(){console.log("LeaderboardOfflineCache: getLeaderboardInfo");var b=$.Deferred();var c={};var d=NativeTransport.callNative({nativeCall:constants.NativeCallTypes.CLEAR_CACHE,target:constants.OfflineCacheTypes.LEADERBOARDS_CACHE,args:c});d.done(function(f,e){console.log("LeaderboardOfflineCache: getLeaderboardInfo complete: "+JSON.stringify(f));b.resolve(f,e)});return b.promise()};this["deleteLeaderboards"]=function(d,e){console.log("LeaderboardOfflineCache: deleteLeaderboards");var b=$.Deferred();var c={};c[constants.NativeCallKeys.SECONDARY_KEY]="leaderMeta-"+d;var f=NativeTransport.callNative({nativeCall:constants.NativeCallTypes.REMOVE_CACHE_ITEMS,target:constants.OfflineCacheTypes.LEADERBOARDS_CACHE,args:c});f.done(function(h,g){console.log("LeaderboardOfflineCache: deleteLeaderboards complete: "+JSON.stringify(h));b.resolve(h,g)});return b.promise()};this["getHighestScoreSubmission"]=function(e,f,d){console.log("LeaderboardOfflineCache: getHighestScoreSubmission");var b=$.Deferred();var c={};c[constants.NativeCallKeys.PRIMARY_KEY]="highestScoreSubmission-"+d+"-"+e;var g=NativeTransport.callNative({nativeCall:constants.NativeCallTypes.GET_CACHE_ITEM,target:constants.OfflineCacheTypes.LEADERBOARDS_CACHE,args:c});g.done(function(i,h){var j={};if(h==constants.NativeCallResultCode.SUCCESS&&i&&i.score){j=i.score}b.resolve(j,h)});return b.promise()};this["getHighestScoreSubmissions"]=function(d){console.log("LeaderboardOfflineCache: getHighestScoreSubmission");var b=$.Deferred();var c={};c[constants.NativeCallKeys.SECONDARY_KEY]="highestScoreSubmission--"+d;var e=NativeTransport.callNative({nativeCall:constants.NativeCallTypes.QUERY_CACHE_ITEMS,target:constants.OfflineCacheTypes.LEADERBOARDS_CACHE,args:c});e.always(function(g,f){var h={HighestScoreSubmissions:[]};if(f==constants.NativeCallResultCode.SUCCESS&&g&&g.queryResult){console.log("LeaderboardOfflineCache: getLeaderboards complete: "+JSON.stringify(g));h={HighestScoreSubmissions:g.queryResult}}b.resolve(h,f)});return b.promise()};this["updateCachedScoreSubmission"]=function(f,g,e,i){console.log("LeaderboardOfflineCache: updateCachedScoreSubmission");var d={};var c={};c[constants.NativeCallKeys.PRIMARY_KEY]="highestScoreSubmission-"+e+"-"+f;c[constants.NativeCallKeys.SECONDARY_KEY]="highestScoreSubmission--"+f;c[constants.NativeCallKeys.JSON_DATA]={leaderboardId:e,score:i};d[constants.NativeCallKeys.CACHE_REQUEST]=c;var b=$.Deferred();var h=this;this.getHighestScoreSubmission(f,g,e).always(function(k,j){if(j!=constants.NativeCallResultCode.SUCCESS){NativeTransport.callNative({nativeCall:constants.NativeCallTypes.SET_CACHE_ITEM,target:constants.OfflineCacheTypes.LEADERBOARDS_CACHE,args:d}).always(function(m,l){b.resolve(m,l)})}else{h.getLeaderboardInfo(g,e).always(function(n,l){if(l!=constants.NativeCallResultCode.SUCCESS||!n||!n.LeaderboardInfo){b.resolve({},constants.NativeCallResultCode.ERROR)}else{var m=n.LeaderboardInfo["SortOrder"];if(m=="DESCENDING"){if(i>k){NativeTransport.callNative({nativeCall:constants.NativeCallTypes.SET_CACHE_ITEM,target:constants.OfflineCacheTypes.LEADERBOARDS_CACHE,args:d}).always(function(p,o){b.resolve(p,o)})}else{b.resolve({},constants.NativeCallResultCode.SUCCESS)}}else{if(i<k){NativeTransport.callNative({nativeCall:constants.NativeCallTypes.SET_CACHE_ITEM,target:constants.OfflineCacheTypes.LEADERBOARDS_CACHE,args:d}).always(function(p,o){b.resolve(p,o)})}else{b.resolve({},constants.NativeCallResultCode.SUCCESS)}}}})}});return b.promise()}};return a}());console.log("LeaderboardOfflineCache loaded.");