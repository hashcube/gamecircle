/*! Copyright 2013 Amazon Digital Services, Inc. All rights reserved. */
FeatureDetectionHandler=(function(){var a=function(e,b){var d="FeatureDetectionRequest";var c=this;this["getHandledType"]=function(){return d};this["getFeaturesUsage"]=function(h){var f=$.Deferred();var g=0;b.getFeaturesUsed().always(function(j){if(h.cacheOnly){f.resolve(new Result(constants.NativeCallResultCode.SUCCESS,j))}else{var i=$.Deferred();e.getFeaturesUsage().always(function(k,l){if(l==constants.NativeCallResultCode.SUCCESS){b.setFeaturesUsed(k)}i.resolve(k,l)});if(JSON.stringify(j)!=="{}"){f.resolve(new Result(constants.NativeCallResultCode.SUCCESS,j))}else{if(h.timeout>0){g=setTimeout(function(){hostinterface.logMessage("FeatureDetectionHandler: getFeaturesUsage timed out");i.resolve({},constants.NativeCallResultCode.NETWORK_ERROR);g=0},h.timeout)}}i.always(function(k,l){if(g){clearTimeout(g)}if(l!=constants.NativeCallResultCode.SUCCESS){b.getFeaturesUsed().always(function(m){f.resolve(new Result(constants.NativeCallResultCode.SUCCESS,m))})}else{f.resolve(new Result(constants.NativeCallResultCode.SUCCESS,k))}})}});return f.promise()}};a.prototype=BaseHandler;return a}());console.log("FeatureDetectionHandler loaded.");